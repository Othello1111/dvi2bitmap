# Makefile for the test directory
#
# - The test of hello.dvi is the basic test of dvi2bitmap
# - magtest.tex is a test of whether dvi2bitmap correctly processes DVI
#   and font magnification.
# - modetest.tex is more of a test of the Metafont modes than one of
#   dvi2bitmap, but it does exercise a range of fonts, and so can show
#   some weaknesses.
#
# $Id$

CXX=@CXX@
CXXFLAGS=-I.. @CXXFLAGS@
PERLBIN=@PERL@
LIBS=@LIBS@

all: test

test: regression pathtest

regression:
	cd ..; $(MAKE) libdvi2bitmap.a
	PERLBIN=$(PERLBIN) ./runtests

pathtest: hello.dvi
	sh ./test-font-gen.sh ../dvi2bitmap hello.dvi
	touch pathtest

magtest: magtest.dvi
	sh ./test-font-gen.sh ../dvi2bitmap magtest.dvi magtest-output

modetest: modetest.dvi
	sh ./test-font-gen.sh ../dvi2bitmap modetest.dvi modetest-output

hello.dvi: hello.tex
	tex hello

magtest.dvi: magtest.tex
	tex magtest

modetest.dvi: modetest.tex
	latex modetest


# These regression tests depend on a libdvi2bitmap.a from the source
# directory.  That directory doesn't use it, but we need it here,
# otherwise linking all the tests is too complicated to deal with happily.
# Add a suffix rule for stupid makes (hello, Tru64...)
.SUFFIXES: .o .cc .run
# .cc.o:
# 	$(CXX) $(CXXFLAGS) -c $<
#
# .o.run:
# 	cd ..; $(MAKE) libdvi2bitmap.a
# 	$(CXX) $(CXXFLAGS) -o $@ $< -L.. -ldvi2bitmap
#  ARGH.  Tru64's make seems unable to cope even with implied dependencies!
.cc.run:
	cd ..; $(MAKE) libdvi2bitmap.a
	$(CXX) $(CXXFLAGS) -o $@ $< -L.. -ldvi2bitmap $(LIBS) -lm


clean:
	rm -f *~ *.o *.run
	rm -f *.log *.aux *.dvi *.pdf
	rm -f pathtest test-output*
