#!/bin/sh -

# Little script to propagate the version stored in the file VERSION.  The
# version strings to be replaced must either be on a line which
# includes the string %%VERSION%% (probably in a comment) or comes
# immediately after such a line.  It must also be the first string
# which matches the regexp.

# Take list of files to be updated from the argument list.
# Insist that there's at least one file given.
if [ $# -le 0 ]; then
    echo "Usage: $0 <filelist>"
    exit 1
fi

# Work through the non-zero argument list doing the edit.
while [ $# -gt 0 ]; do
    f=$1
    if test VERSION -nt $f; then
	echo -n "Updating $f..."
	sed '/%%VERSION%%/{N;s/[0-9][0-9.-]\+[a-z]*/'`cat VERSION`'/;}' \
		$f >$f.tmp && mv $f.tmp $f && echo "ok"
    fi
    shift
done

exit 0

# $Id$
